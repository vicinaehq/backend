// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client"
  output   = "../src/generated/prisma"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

enum Platform {
	Linux
	MacOS
	Windows
}

// always latest version
model Extension {
	id String @id @default(nanoid())
	name String
	title String
	description String
	downloadCount Int @default(0)
	// @vicinae/api dependency version
	apiVersion String
	// storage key for the archive (e.g., "extensions/author/name/latest.zip")
	storageKey String
	// SHA-256 checksum of the ZIP archive for integrity verification
	checksum String
	// flag to indicate if extension is trending (e.g., high recent download velocity)
	trending Boolean @default(false)
	// Extension icon storage keys
	iconLight String?
	iconDark String?
	// README storage key
	readmeKey String?
	categories ExtensionCategory[]
	commands Command[]
	createdAt DateTime @default(now())
	updatedAt DateTime @updatedAt
	author User? @relation(fields: [authorId], references: [id])
	authorId String
	killListedAt DateTime? // to quickly blacklist an extension if for some reason we need to
	platforms ExtensionPlatform[]

	@@unique([authorId, name])
}

model Command {
	id String @id @default(nanoid())
	name String
	title String
	subtitle String?
	description String?
	keywords Json // array of strings
	mode String // "view" | "no-view" | "menu-bar"
	disabledByDefault Boolean @default(false)
	beta Boolean @default(false)
	iconLight String?
	iconDark String?
	extension Extension @relation(fields: [extensionId], references: [id], onDelete: Cascade)
	extensionId String

	@@unique([extensionId, name])
}

model ExtensionPlatform {
	id Platform @id
	extensions Extension[]
}

model ExtensionCategory {
	id String @id 
	name String
	extensions Extension[]
}

model GitHubUser {
	id String @id
	user User?
}

model User {
	id String @id @default(nanoid())
	name String? // Display name (e.g., from GitHub or other auth providers)
	github GitHubUser? @relation(fields: [githubId], references: [id])
	githubId String @unique
	extensions Extension[]
}
